<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyCodex AI - Simple & Trustworthy</title>
    <!-- Tailwind CSS CDN for a clean, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font for professional, highly readable typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define the primary font for the entire page */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* A very light blue-gray background for a calming effect */
        }

        /* Custom scrollbar for the policy output area for better aesthetics */
        .policy-scroll {
            max-height: 70vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #e2e8f0 #f8fafc;
        }

        .policy-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .policy-scroll::-webkit-scrollbar-track {
            background: #f8fafc;
            border-radius: 10px;
        }

        .policy-scroll::-webkit-scrollbar-thumb {
            background-color: #e2e8f0;
            border-radius: 10px;
            border: 2px solid #f8fafc;
        }

        /* Styling for the generated policy content (to be consistent and readable) */
        #policyOutput h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #1f2937; /* Darker text for headings */
        }

        #policyOutput h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        #policyOutput p, #policyOutput li {
            margin-bottom: 0.5rem;
            line-height: 1.625;
        }

        #policyOutput ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
    </style>
</head>
<body>

    <!-- Main Application Container -->
    <div class="max-w-7xl mx-auto p-4 sm:p-6 md:p-10 flex flex-col items-center min-h-screen">

        <!-- Header/Branding Section -->
        <header class="w-full text-center mb-10">
            <h1 class="text-5xl font-extrabold text-gray-900 mb-2">
                <span class="text-blue-600">PolicyCodex</span> AI
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Generate a GDPR-compliant Privacy Policy for your business instantly. No legal jargon, just razor-sharp compliance.
            </p>
        </header>

        <!-- Main Content Wrapper: Input Form & Policy Output -->
        <main class="w-full flex flex-col lg:flex-row gap-8 bg-white rounded-3xl shadow-2xl p-6 sm:p-10 transition-all duration-300">
            
            <!-- Input & Controls Section -->
            <section class="lg:w-1/2 flex flex-col justify-center">
                <div class="space-y-6">
                    <div>
                        <label for="businessName" class="block text-gray-700 font-semibold mb-2">Your Business Name</label>
                        <input type="text" id="businessName" placeholder="e.g., My Awesome Startup Ltd."
                               class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label for="websiteUrl" class="block text-gray-700 font-semibold mb-2">Your Website URL</label>
                        <input type="url" id="websiteUrl" placeholder="e.g., https://www.example.com"
                               class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                </div>

                <!-- Jurisdiction Box - Adds Trust and Clarity -->
                <div class="mt-8 bg-blue-50 border border-blue-200 text-blue-800 px-5 py-4 rounded-xl text-sm shadow-inner">
                    <p class="font-bold">Target Jurisdiction (MVP):</p>
                    <p>United Kingdom & European Union (GDPR)</p>
                </div>

                <!-- Call to Action Button -->
                <div class="mt-8">
                    <button id="generateBtn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition duration-300 ease-in-out hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 disabled:bg-gray-400 disabled:cursor-not-allowed">
                        Generate Free GDPR Policy
                    </button>
                </div>

                <!-- Status and Error Messages -->
                <div id="statusContainer" class="mt-4 text-center">
                    <div id="loadingIndicator" class="hidden text-blue-600 font-medium">
                        <div class="animate-spin inline-block w-6 h-6 border-4 border-t-transparent border-blue-600 rounded-full mr-2"></div>
                        <p class="inline">Generating your policy...</p>
                    </div>
                    <div id="messageBox" class="hidden px-4 py-3 rounded-xl relative text-sm font-medium">
                        <span id="messageText"></span>
                    </div>
                </div>
            </section>

            <!-- Policy Output Section -->
            <section class="lg:w-1/2 bg-gray-50 p-6 rounded-2xl border border-gray-200 shadow-inner flex flex-col">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Your Generated Policy</h2>
                
                <!-- Policy Content Display Area -->
                <div id="policyOutput" class="policy-scroll text-gray-700 text-sm flex-1">
                    <p class="text-center text-gray-400 italic">Fill out the form and click "Generate" to see your policy here.</p>
                </div>

                <!-- Policy Actions & Upsell -->
                <div id="policyActions" class="hidden mt-6 space-y-4 md:space-y-0 md:flex md:gap-4 justify-center items-center">
                    <button id="copyBtn"
                            class="w-full md:w-auto flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-300 transform hover:scale-105">
                        Copy Policy Text
                    </button>
                    <button id="downloadBtn"
                            class="w-full md:w-auto flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-300 transform hover:scale-105">
                        Download as .txt
                    </button>
                </div>
                
                <!-- Upsell Section -->
                <div id="upsellSection" class="hidden mt-6 text-center text-gray-600 text-sm">
                    <p class="font-bold text-lg mb-2">Want a full, professional policy?</p>
                    <a id="waitlistBtn" href="#"
                       class="inline-block bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-300 transform hover:scale-105">
                        Join Our Pro Waitlist!
                    </a>
                </div>

                <!-- Disclaimer for trustworthiness -->
                <footer class="mt-6 text-center text-gray-500 text-xs">
                    <p>This tool is for informational purposes only and does not constitute legal advice. Please consult with a legal professional for specific guidance.</p>
                </footer>
            </section>
        </main>
    </div>

    <!-- Done-for-You Modal -->
    <div id="doneForYouModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full shadow-2xl relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-3xl font-bold text-gray-900 text-center mb-4">Premium "Done-for-You" Service</h2>
            <p class="text-gray-700 text-lg text-center mb-6">
                For businesses needing a deeply customized policy. We handle everything, ensuring razor-sharp compliance.
            </p>
            <div class="text-center">
                <a href="mailto:your.email@example.com?subject=Inquiry%20about%20Premium%20Policy%20Service"
                   class="inline-block bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-300 transform hover:scale-105">
                    Request a Quote
                </a>
            </div>
        </div>
    </div>

    <script>
        // Get references to all necessary DOM elements
        const businessNameInput = document.getElementById('businessName');
        const websiteUrlInput = document.getElementById('websiteUrl');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const policyOutput = document.getElementById('policyOutput');
        const policyActions = document.getElementById('policyActions');
        const upsellSection = document.getElementById('upsellSection');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const waitlistBtn = document.getElementById('waitlistBtn');
        const doneForYouModal = document.getElementById('doneForYouModal');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // Function to display messages (error or success) to the user
        function showMessage(message, isError = false) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'border-red-400', 'text-red-700', 'bg-green-100', 'border-green-400', 'text-green-700');
            if (isError) {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            }
            messageBox.classList.remove('hidden');
        }

        // Function to hide all status indicators
        function hideStatus() {
            loadingIndicator.classList.add('hidden');
            messageBox.classList.add('hidden');
        }

        // Event listener for the main Generate button
        generateBtn.addEventListener('click', async () => {
            const businessName = businessNameInput.value.trim();
            const websiteUrl = websiteUrlInput.value.trim();

            // Basic input validation
            if (!businessName || !websiteUrl) {
                showMessage('Please enter both your Business Name and Website URL.', true);
                return;
            }
            if (!websiteUrl.startsWith('http://') && !websiteUrl.startsWith('https://')) {
                showMessage('Website URL must start with http:// or https://', true);
                return;
            }

            // Hide previous outputs and show loading state
            hideStatus();
            policyOutput.innerHTML = `<p class="text-center text-gray-400 italic">Please wait while we generate your policy...</p>`;
            policyActions.classList.add('hidden');
            upsellSection.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            generateBtn.disabled = true;

            // Construct the prompt for the Gemini API, asking for HTML-formatted output
            const prompt = `Generate a comprehensive and legally sound GDPR (General Data Protection Regulation) compliant Privacy Policy for an online business.
            The business name is "${businessName}" and its website URL is "${websiteUrl}".
            
            The policy must be returned as a complete HTML snippet, including h2 tags for main sections, h3 tags for sub-sections, and ul/li tags for lists. The content should be clear, concise, and easy to understand for the average user.
            
            The policy must cover the following key sections:
            
            <h2>Introduction</h2>
            <p>Briefly introduce the company, its website, and the purpose of the Privacy Policy (data protection commitment).</p>
            
            <h2>Data Controller Information</h2>
            <p>Clearly state the data controller (the business name provided).</p>
            
            <h2>Types of Data Collected</h2>
            <p>List common types of personal data collected by a typical website/online business (e.g., personal identification data like name, email, address; contact data; technical data like IP address, browser type, device info; usage data like pages visited, time spent; marketing and communications data).</p>
            
            <h2>How Data is Collected</h2>
            <p>Explain methods (e.g., direct input from user, automated technologies like cookies, analytics tools, third-party sources).</p>
            
            <h2>Purposes and Lawful Basis for Processing</h2>
            <p>For each type of data or collection method, explain the specific purpose for collecting it and the corresponding lawful basis under GDPR (e.g., necessity for contract, legitimate interests, consent, legal obligation). Provide examples relevant to an online business (e.g., processing orders, sending newsletters, improving website, analytics, legal compliance).</p>
            
            <h2>Data Sharing and Disclosure</h2>
            <p>Explain if and with whom data is shared (e.g., service providers, payment processors, analytics providers, legal/regulatory authorities). Emphasize data protection agreements with third parties.</p>
            
            <h2>International Data Transfers</h2>
            <p>Briefly mention if data is transferred outside the EEA/UK and the safeguards in place (e.g., Standard Contractual Clauses).</p>
            
            <h2>Data Security</h2>
            <p>Describe general measures taken to protect data (e.g., encryption, access controls).</p>
            
            <h2>Data Retention</h2>
            <p>State how long personal data is kept and the criteria for determining retention periods.</p>
            
            <h2>Your Legal Rights (Data Subject Rights)</h2>
            <p>Detail the user's rights under GDPR (Right to Access, Rectification, Erasure (Right to be Forgotten), Restriction of Processing, Data Portability, Object to Processing, Rights in relation to Automated Decision-Making and Profiling). Explain how to exercise these rights.</p>
            
            <h2>Complaints</h2>
            <p>How users can complain to the supervisory authority (ICO in the UK, or relevant EU DPA).</p>
            
            <h2>Cookies Policy</h2>
            <p>A brief statement about the use of cookies and a reference to a dedicated cookie policy (even if it's just part of this document for MVP).</p>
            
            <h2>Changes to This Privacy Policy</h2>
            <p>State that the policy may be updated and how users will be informed.</p>
            
            <h2>Contact Us</h2>
            <p>Provide clear contact details (email address for privacy inquiries, business address if applicable).</p>
            
            The final output must be a single, well-formed HTML string.`;

            // The following is the Gemini API call using the non-streaming method.
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();
                let generatedText = "Failed to generate policy. Please try again.";

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    generatedText = result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Unexpected API response structure or no content generated.");
                }

                // Add a subtle watermark to the generated policy for the free version
                const watermarkedPolicy = `
                    <div class="text-center text-gray-400 italic font-medium mb-4 p-2 border-b border-gray-200">
                        --- PolicyCodex AI - Free MVP Version ---
                    </div>
                    ${generatedText}
                    <div class="text-center text-gray-400 italic font-medium mt-6 p-2 border-t border-gray-200">
                        --- PolicyCodex AI - Free MVP Version ---
                    </div>
                `;

                policyOutput.innerHTML = watermarkedPolicy;
                policyActions.classList.remove('hidden');
                upsellSection.classList.remove('hidden');
                showMessage('Policy generated successfully!', false);

            } catch (error) {
                console.error('Error generating policy:', error);
                showMessage(`Failed to generate policy: ${error.message}. Please try again.`, true);
                policyOutput.innerHTML = `<p class="text-center text-red-500 font-semibold">Error generating policy. Please check your inputs and try again.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.disabled = false;
            }
        });

        // Event listener for Copy button
        copyBtn.addEventListener('click', () => {
            const policyContent = policyOutput.innerText; // Get plain text content
            if (policyContent) {
                const textarea = document.createElement('textarea');
                textarea.value = policyContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showMessage('Policy copied to clipboard!', false);
            }
        });

        // Event listener for Download button (simulated plain text download)
        downloadBtn.addEventListener('click', () => {
            const policyContent = policyOutput.innerText;
            if (policyContent) {
                const blob = new Blob([policyContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'PolicyCodex_Privacy_Policy_MVP.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showMessage('Policy downloaded!', false);
            }
        });

        // Event listener for the "Done-for-You" modal link
        waitlistBtn.addEventListener('click', (e) => {
            e.preventDefault();
            doneForYouModal.classList.add('flex');
            doneForYouModal.classList.remove('hidden');
        });

        // Event listeners for the modal close button and clicking outside the modal
        closeModalBtn.addEventListener('click', () => {
            doneForYouModal.classList.add('hidden');
            doneForYouModal.classList.remove('flex');
        });
        
        doneForYouModal.addEventListener('click', (e) => {
            if (e.target === doneForYouModal) {
                doneForYouModal.classList.add('hidden');
                doneForYouModal.classList.remove('flex');
            }
        });
    </script>
</body>
</html>
