<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyCodex AI - Free GDPR Privacy Policy Generator</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        /* Custom scrollbar for policy content */
        .policy-content-scroll {
            max-height: 70vh; /* Limit height to enable scrolling */
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f7fafc;
        }
        .policy-content-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .policy-content-scroll::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 10px;
        }
        .policy-content-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
            border: 2px solid #f7fafc;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl p-8 md:p-10 w-full max-w-4xl flex flex-col lg:flex-row gap-8">
        <!-- Input and Controls Section -->
        <div class="lg:w-1/2 flex flex-col space-y-6">
            <h1 class="text-4xl font-bold text-gray-900 text-center lg:text-left mb-4">
                <span class="text-blue-600">PolicyCodex</span> AI
            </h1>
            <p class="text-gray-600 text-lg text-center lg:text-left">
                Generate a GDPR-compliant Privacy Policy instantly for your website.
                No legal jargon, just razor-sharp compliance.
            </p>

            <!-- Input Fields -->
            <div>
                <label for="businessName" class="block text-gray-700 text-sm font-medium mb-2">Your Business Name</label>
                <input type="text" id="businessName" placeholder="e.g., My Awesome Startup Ltd."
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-900">
            </div>
            <div>
                <label for="websiteUrl" class="block text-gray-700 text-sm font-medium mb-2">Your Website URL</label>
                <input type="url" id="websiteUrl" placeholder="e.g., https://www.example.com"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-900">
            </div>

            <!-- Jurisdiction (Fixed for MVP) -->
            <div class="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg text-sm">
                <p class="font-semibold">Target Jurisdiction (MVP):</p>
                <p>United Kingdom & European Union (GDPR)</p>
            </div>

            <!-- Generate Button -->
            <button id="generateBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                Generate GDPR Policy
            </button>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden text-center text-blue-600 font-medium">
                <div class="animate-spin inline-block w-6 h-6 border-4 border-t-transparent border-blue-600 rounded-full"></div>
                <p class="mt-2">Generating your policy...</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline" id="errorText"></span>
            </div>
        </div>

        <!-- Policy Output Section -->
        <div class="lg:w-1/2 bg-gray-50 p-6 rounded-lg border border-gray-200 flex flex-col">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Your Generated Privacy Policy</h2>
            <div id="policyOutput" class="policy-content-scroll text-gray-700 leading-relaxed text-sm bg-white p-4 rounded-md border border-gray-100 relative">
                <p class="text-center text-gray-500 italic">Your policy will appear here after generation. This is an MVP version for demonstration purposes.</p>
                <p class="text-center text-gray-400 italic mt-2">Generated by PolicyCodex AI - Free MVP Version</p>
            </div>

            <!-- Action Buttons for Policy -->
            <div id="policyActions" class="hidden mt-6 space-y-3 md:space-y-0 md:flex md:gap-4 justify-center">
                <button id="copyBtn"
                        class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75">
                    Copy Policy
                </button>
                <button id="downloadBtn"
                        class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75">
                    Download Policy
                </button>
            </div>

            <!-- Upgrade Call to Action -->
            <div class="mt-6 text-center text-gray-600 text-sm">
                <p>This is a free MVP version from PolicyCodex AI.</p>
                <p class="mt-1">For unwatermarked policies, auto-updates, and more features, stay tuned for our full launch!</p>
                <p class="mt-2 text-blue-600 font-semibold">Visit <a href="https://www.policycodex.com" target="_blank" class="hover:underline">policycodex.com</a> for updates.</p>
            </div>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const businessNameInput = document.getElementById('businessName');
        const websiteUrlInput = document.getElementById('websiteUrl');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const policyOutput = document.getElementById('policyOutput');
        const policyActions = document.getElementById('policyActions');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        // Function to show error message
        function showMessage(element, message, isError = true) {
            element.textContent = message;
            element.classList.remove('hidden');
            if (isError) {
                element.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else {
                element.classList.remove('bg-red-100', 'border-red-400', 'text-red-700');
            }
        }

        // Event listener for the Generate button
        generateBtn.addEventListener('click', async () => {
            const businessName = businessNameInput.value.trim();
            const websiteUrl = websiteUrlInput.value.trim();

            // Basic input validation
            if (!businessName || !websiteUrl) {
                showMessage(errorMessage, 'Please enter both your Business Name and Website URL.');
                return;
            }
            if (!websiteUrl.startsWith('http://') && !websiteUrl.startsWith('https://')) {
                showMessage(errorMessage, 'Website URL must start with http:// or https://');
                return;
            }

            // Hide previous messages and show loading indicator
            errorMessage.classList.add('hidden');
            policyOutput.innerHTML = ''; // Clear previous policy
            policyActions.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            generateBtn.disabled = true; // Disable button during generation

            // Construct the prompt for the Gemini API
            const prompt = `Generate a comprehensive and legally sound GDPR (General Data Protection Regulation) compliant Privacy Policy for an online business.
            The business name is "${businessName}" and its website URL is "${websiteUrl}".

            The policy should cover the following key sections and details, ensuring it is clear, concise, and easy to understand for the average user:

            1.  **Introduction:** Briefly introduce the company, its website, and the purpose of the Privacy Policy (data protection commitment).
            2.  **Data Controller Information:** Clearly state the data controller (the business name provided).
            3.  **Types of Data Collected:** List common types of personal data collected by a typical website/online business (e.g., personal identification data like name, email, address; contact data; technical data like IP address, browser type, device info; usage data like pages visited, time spent; marketing and communications data).
            4.  **How Data is Collected:** Explain methods (e.g., direct input from user, automated technologies like cookies, analytics tools, third-party sources).
            5.  **Purposes and Lawful Basis for Processing:** For each type of data or collection method, explain the specific purpose for collecting it and the corresponding lawful basis under GDPR (e.g., necessity for contract, legitimate interests, consent, legal obligation). Provide examples relevant to an online business (e.g., processing orders, sending newsletters, improving website, analytics, legal compliance).
            6.  **Data Sharing and Disclosure:** Explain if and with whom data is shared (e.g., service providers, payment processors, analytics providers, legal/regulatory authorities). Emphasize data protection agreements with third parties.
            7.  **International Data Transfers:** Briefly mention if data is transferred outside the EEA/UK and the safeguards in place (e.g., Standard Contractual Clauses).
            8.  **Data Security:** Describe general measures taken to protect data (e.g., encryption, access controls).
            9.  **Data Retention:** State how long personal data is kept and the criteria for determining retention periods.
            10. **Your Legal Rights (Data Subject Rights):** Detail the user's rights under GDPR (Right to Access, Rectification, Erasure (Right to be Forgotten), Restriction of Processing, Data Portability, Object to Processing, Rights in relation to Automated Decision-Making and Profiling). Explain how to exercise these rights.
            11. **Complaints:** How users can complain to the supervisory authority (ICO in the UK, or relevant EU DPA).
            12. **Cookies Policy:** A brief statement about the use of cookies and a reference to a dedicated cookie policy (even if it's just part of this document for MVP).
            13. **Changes to This Privacy Policy:** State that the policy may be updated and how users will be informed.
            14. **Contact Us:** Provide clear contact details (email address for privacy inquiries, business address if applicable).

            Ensure the language is professional, clear, and avoids overly technical jargon where possible. Format it with clear headings and paragraphs for readability.`;

            try {
                // Gemini API call
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide the API key at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();
                let generatedText = "Failed to generate policy. Please try again.";

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    generatedText = result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Unexpected API response structure or no content generated.");
                }

                // Add a prominent watermark for the MVP version
                const watermarkedPolicy = `
                    <div class="text-center text-gray-400 italic mb-4">
                        --- PolicyCodex AI - Free MVP Version ---
                    </div>
                    ${generatedText.replace(/\n/g, '<br>')}
                    <div class="text-center text-gray-400 italic mt-4">
                        --- PolicyCodex AI - Free MVP Version ---
                        <br>
                        For unwatermarked policies, auto-updates, and more features, visit policycodex.com
                    </div>
                `;

                policyOutput.innerHTML = watermarkedPolicy;
                policyActions.classList.remove('hidden');

            } catch (error) {
                console.error('Error generating policy:', error);
                showMessage(errorMessage, `Failed to generate policy: ${error.message}. Please try again.`);
                policyOutput.innerHTML = `<p class="text-center text-red-500">Error generating policy. Please check your inputs and try again.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.disabled = false; // Re-enable button
            }
        });

        // Event listener for Copy button
        copyBtn.addEventListener('click', () => {
            const policyContent = policyOutput.innerText; // Get plain text content
            if (policyContent) {
                const textarea = document.createElement('textarea');
                textarea.value = policyContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy'); // Use execCommand for broader compatibility in iframes
                document.body.removeChild(textarea);
                showMessage(errorMessage, 'Policy copied to clipboard!', false); // Show success message
                setTimeout(() => errorMessage.classList.add('hidden'), 3000); // Hide after 3 seconds
            }
        });

        // Event listener for Download button
        downloadBtn.addEventListener('click', () => {
            const policyContent = policyOutput.innerText; // Get plain text content
            if (policyContent) {
                const blob = new Blob([policyContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'PolicyCodex_Privacy_Policy_MVP.txt'; // Suggest a filename
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url); // Clean up
                showMessage(errorMessage, 'Policy downloaded!', false); // Show success message
                setTimeout(() => errorMessage.classList.add('hidden'), 3000); // Hide after 3 seconds
            }
        });
    </script>
</body>
</html>

